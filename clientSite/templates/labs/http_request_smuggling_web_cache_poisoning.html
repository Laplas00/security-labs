
{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">

  <h2>üí£ HTTP Request Smuggling + Web Cache Poisoning</h2>
  <br>

  <p><strong>–≠—Ç–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –ø—Ä–æ–∫—Å–∏ –∏ –±–µ–∫–µ–Ω–¥–æ–º –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</strong></p>

  <p>–°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:  
    <a href="http://laplasrouse2-http_request_smuggling_web_cache_poisoning.labs-is-here.online" target="_blank">
      laplasrouse2-http_request_smuggling_web_cache_poisoning.labs-is-here.online
    </a>
  </p>

  <hr>

  <h4>üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å</h4>
  <p>–¢—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –æ–¥–∏–Ω HTTP-–∑–∞–ø—Ä–æ—Å, –Ω–æ **–±–µ–∫–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç –¥–≤–∞**. –ü–æ—á–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –¥–∞—ë—à—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:</p>
  <ul>
    <li><code>Content-Length: 4</code> ‚Äî –≥–æ–≤–æ—Ä–∏—Ç "—Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ = 4 –±–∞–π—Ç–∞"</li>
    <li><code>Transfer-Encoding: chunked</code> ‚Äî –≥–æ–≤–æ—Ä–∏—Ç "—Ç–µ–ª–æ –∏–¥—ë—Ç —á–∞–Ω–∫–∞–º–∏"</li>
  </ul>

  <p><strong>Nginx</strong> –¥–æ–≤–µ—Ä—è–µ—Ç <code>Content-Length</code> –∏ –¥—É–º–∞–µ—Ç, —á—Ç–æ —Ç–µ–ª–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 4 –±–∞–π—Ç–∞.  
  <strong>Flask</strong> –¥–æ–≤–µ—Ä—è–µ—Ç <code>Transfer-Encoding</code> –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —á–∏—Ç–∞—Ç—å, –¥–∞–∂–µ –ø–æ—Å–ª–µ "–∫–æ–Ω—Ü–∞ —Ç–µ–ª–∞".</p>

  <pre><code>
POST / HTTP/1.1
Host: vulnerable
Content-Length: 4
Transfer-Encoding: chunked

0

GET /cached?user=admin HTTP/1.1
Host: vulnerable
  </code></pre>

  <p>–î–ª—è Nginx —ç—Ç–æ –æ–¥–∏–Ω –∑–∞–∫–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å. –î–ª—è Flask ‚Äî —ç—Ç–æ <strong>–¥–≤–∞</strong>: POST –∏ –∑–∞—Ç–µ–º GET.</p>

  <hr>

  <h4>üì¨ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:</h4>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
        <th>–ß—Ç–æ –≤–∏–¥–∏—Ç</th>
        <th>–ß—Ç–æ –¥—É–º–∞–µ—Ç</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Nginx (–ø—Ä–æ–∫—Å–∏)</td>
        <td>POST + —Ç–µ–ª–æ = "0\\r\\n\\r\\n"</td>
        <td>–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à—ë–Ω, –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ</td>
      </tr>
      <tr>
        <td>Flask (–±–µ–∫–µ–Ω–¥)</td>
        <td>POST, –∑–∞—Ç–µ–º <code>GET /cached?user=admin</code></td>
        <td>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–∞ –∑–∞–ø—Ä–æ—Å–∞</td>
      </tr>
    </tbody>
  </table>

  <hr>

  <h4>üéØ –¶–µ–ª—å: –æ—Ç—Ä–∞–≤–∏—Ç—å –∫—ç—à</h4>
  <p>–ï—Å–ª–∏ –≤—Ç–æ—Ä–æ–π (—Å–∫—Ä—ã—Ç—ã–π) –∑–∞–ø—Ä–æ—Å –∫ <code>/cached?user=admin</code> –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∏ –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω, —Ç–æ –ª—é–±–æ–π, –∫—Ç–æ –∑–∞–π–¥—ë—Ç –Ω–∞ <code>/cached?user=guest</code>, —É–≤–∏–¥–∏—Ç –ø–æ–¥–º–µ–Ω—ë–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.</p>

  <h5>–ü—Ä–∏–º–µ—Ä: —Å–Ω–∞—á–∞–ª–∞</h5>
  <pre><code>
curl http://.../cached?user=guest
‚Üí Welcome guest
  </code></pre>

  <h5>–ü–æ—Å–ª–µ –∞—Ç–∞–∫–∏:</h5>
  <pre><code>
curl http://.../cached?user=guest
‚Üí Welcome admin üòà
  </code></pre>

  <hr>

  <h4>üß™ –ö–∞–∫ –∞—Ç–∞–∫–æ–≤–∞—Ç—å (Burp/Netcat)</h4>
  <ul>
    <li>–í–∫–ª—é—á–∏ <strong>HTTP/2 downgrade</strong> –≤ Burp</li>
    <li>–û—Ç–ø—Ä–∞–≤—å –∑–∞–ø—Ä–æ—Å –≤—ã—à–µ</li>
    <li>–ü—Ä–æ–≤–µ—Ä—å, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ –æ—Ç–≤–µ—Ç –æ—Ç /cached?user=guest</li>
    <li>–ï—Å–ª–∏ –¥–∞ ‚Äî —É—è–∑–≤–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
  </ul>

  <hr>

  <h4>üîí –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å</h4>
  <ul>
    <li>–ü—Ä–æ–∫—Å–∏ –∏ —Å–µ—Ä–≤–µ—Ä **–¥–æ–ª–∂–Ω—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É –ø–∞—Ä—Å–∏—Ç—å** –≥—Ä–∞–Ω–∏—Ü—ã –∑–∞–ø—Ä–æ—Å–∞</li>
    <li>Flask –¥–æ–≤–µ—Ä—è–µ—Ç Transfer-Encoding ‚Üí –∏ —á–∏—Ç–∞–µ—Ç "–≤—Å—ë —á—Ç–æ –ø–æ—Å–ª–µ"</li>
    <li>–¢—ã –≤–Ω–µ–¥—Ä—è–µ—à—å "–Ω–µ–≤–∏–¥–∏–º—ã–π" –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å ‚Äî –∏ backend –µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç</li>
    <li>–≠—Ç–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è XSS, –æ–±—Ö–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –∫—Ä–∞–∂–∏ —Ç–æ–∫–µ–Ω–æ–≤</li>
  </ul>

  <p>–¢–µ–ø–µ—Ä—å ‚Äî —Ç—ã –∑–Ω–∞–µ—à—å. –ü–æ–ø—Ä–æ–±—É–π –æ—Ç—Ä–∞–≤–∏—Ç—å –∫—ç—à –∏ —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –º–∏—Ä —Å–∫–ª–æ–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ HTTP-—Ö–∞–∫–µ—Ä–æ–º.</p>

  <p>Status: {{ vuln_mode }}</p>
  <p>App status: {{ status }}</p>

  {% if status.status == "running" %}
  <p><a href="{{ status.url }}">üöÄ Open the vulnerable lab</a></p>

  <form action="{% url 'stop_lab' %}" method="POST" style="display: inline">
    {% csrf_token %}
    <button type="submit">üõë Stop Lab</button>
    <input type="hidden" name="lab" value="{{ lab_name }}">
  </form>

  <form action="{% url 'toggle_vuln' %}" method="POST" style="display: inline">
    {% csrf_token %}
    <input type="hidden" name="lab" value="{{ lab_name }}">
    <button type="submit">‚öôÔ∏è Toggle Vulnerability</button>
  </form>

  {% else %}
  <form action="{% url 'start_lab' %}" method="POST" style="display: inline">
    {% csrf_token %}
    <input type="hidden" name="lab" value="{{ lab_name }}">
    <button type="submit">üöÄ Start Lab</button>
  </form>
  {% endif %}

</div>
{% endblock %}

